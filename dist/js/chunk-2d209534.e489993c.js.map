{"version":3,"sources":["webpack:///./src/views/TableView.vue?9fa2","webpack:///src/views/TableView.vue","webpack:///./src/views/TableView.vue?a028","webpack:///./src/views/TableView.vue"],"names":["render","_vm","this","_h","$createElement","_c","_self","attrs","records","on","onRecordSelected","scopedSlots","_u","key","fn","row","item","url","_v","onValidModal","model","value","record","callback","$$v","$set","expression","proxy","directives","name","rawName","modifiers","addNote","note","addFiles","onInput","files","ref","staticRenderFns","props","data","created","console","log","getRecords","methods","r","length","$bvModal","show","component"],"mappings":"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","file":"js/chunk-2d209534.e489993c.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_c('b-table',{attrs:{\"hover\":\"\",\"items\":_vm.records,\"selectable\":\"\",\"select-mode\":\"single\",\"selected-variant\":\"primary\"},on:{\"row-selected\":_vm.onRecordSelected},scopedSlots:_vm._u([{key:\"cell(url)\",fn:function(row){return [_c('b-button',{attrs:{\"pill\":\"\",\"variant\":\"outline-primary\",\"size\":\"sm\"}},[_c('a',{attrs:{\"href\":row.item.url,\"target\":\"_blank\"}},[_c('b-icon-link45deg')],1)])]}}])}),_c('a',{attrs:{\"href\":_vm.url,\"target\":\"_blank\"}},[_vm._v(\"table \"),_c('b-icon-link45deg')],1),_c('br'),_c('b-modal',{attrs:{\"id\":\"modal-record\"},on:{\"ok\":_vm.onValidModal},scopedSlots:_vm._u([{key:\"modal-title\",fn:function(){return [_c('EditableSpan',{model:{value:(_vm.record.name),callback:function ($$v) {_vm.$set(_vm.record, \"name\", $$v)},expression:\"record.name\"}})]},proxy:true}])},[_c('b-button',{directives:[{name:\"b-modal\",rawName:\"v-b-modal.modal-note\",modifiers:{\"modal-note\":true}}],attrs:{\"pill\":\"\",\"size\":\"sm\"}},[_c('b-icon-plus'),_vm._v(\" Add a note\")],1),_c('b-button',{directives:[{name:\"b-modal\",rawName:\"v-b-modal.modal-files\",modifiers:{\"modal-files\":true}}],attrs:{\"pill\":\"\",\"variant\":\"outline-primary\",\"size\":\"sm\"}},[_c('b-icon-plus'),_vm._v(\" Add images files\")],1)],1),_c('b-modal',{attrs:{\"id\":\"modal-note\",\"title\":\"New Note\"},on:{\"ok\":_vm.addNote}},[_c('b-form-textarea',{attrs:{\"id\":\"textarea\",\"placeholder\":\"Enter something...\",\"rows\":\"3\",\"max-rows\":\"6\"},model:{value:(_vm.note),callback:function ($$v) {_vm.note=$$v},expression:\"note\"}})],1),_c('b-modal',{attrs:{\"id\":\"modal-files\",\"title\":\"Add files\"},on:{\"ok\":_vm.addFiles}},[_c('b-form-file',{attrs:{\"multiple\":\"\",\"accept\":\"*\",\"placeholder\":\"Choose a file or drop it here...\",\"drop-placeholder\":\"Drop file here...\"},on:{\"input\":_vm.onInput},model:{value:(_vm.files),callback:function ($$v) {_vm.files=$$v},expression:\"files\"}}),_c('div',{ref:\"preview\"})],1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n  <div>\r\n\r\n    <b-table\r\n    hover\r\n    :items=\"records\"\r\n    selectable\r\n    select-mode=\"single\"\r\n    selected-variant=\"primary\"\r\n    @row-selected=\"onRecordSelected\">\r\n    <template #cell(url)=\"row\">\r\n      <b-button pill variant=\"outline-primary\" size=\"sm\"><a :href=\"row.item.url\" target=\"_blank\"><b-icon-link45deg></b-icon-link45deg></a></b-button>\r\n    </template>\r\n  </b-table>\r\n\r\n\r\n\r\n  <a :href=\"url\" target=\"_blank\">table <b-icon-link45deg></b-icon-link45deg></a>\r\n\r\n\r\n  <br>\r\n  <!-- {{records}} -->\r\n\r\n\r\n  <b-modal id=\"modal-record\"\r\n  @ok=\"onValidModal\">\r\n  <template #modal-title>\r\n    <EditableSpan v-model=\"record.name\" />\r\n  </template>\r\n\r\n\r\n  <b-button pill size=\"sm\" v-b-modal.modal-note><b-icon-plus></b-icon-plus> Add a note</b-button>\r\n  <b-button pill variant=\"outline-primary\" v-b-modal.modal-files size=\"sm\"><b-icon-plus></b-icon-plus> Add images files</b-button>\r\n\r\n\r\n\r\n\r\n  <!-- <p class=\"my-4\">Hello from modal!</p> -->\r\n\r\n</b-modal>\r\n\r\n\r\n<b-modal id=\"modal-note\" title=\"New Note\" @ok=\"addNote\">\r\n  <b-form-textarea\r\n  id=\"textarea\"\r\n  v-model=\"note\"\r\n  placeholder=\"Enter something...\"\r\n  rows=\"3\"\r\n  max-rows=\"6\"\r\n  ></b-form-textarea>\r\n</b-modal>\r\n\r\n<b-modal id=\"modal-files\" title=\"Add files\" @ok=\"addFiles\">\r\n  <b-form-file multiple\r\n  accept=\"*\"\r\n  v-model=\"files\"\r\n  placeholder=\"Choose a file or drop it here...\"\r\n  drop-placeholder=\"Drop file here...\"\r\n  @input=\"onInput\"\r\n  ></b-form-file>\r\n  <div ref=\"preview\"></div>\r\n</b-modal>\r\n</div>\r\n</template>\r\n\r\n<script>\r\nimport ldflex from '@solid/query-ldflex/lib/exports/rdflib'\r\nimport { namedNode } from \"@rdfjs/data-model\";\r\nimport auth from 'solid-auth-client';\r\nimport FC from 'solid-file-client'\r\nconst fc = new FC( auth )\r\nimport { v4 as uuidv4 } from 'uuid';\r\nimport watermark from 'watermarkjs'\r\n\r\nexport default {\r\n  name:\"TableView\",\r\n  props: ['url'],\r\n  data() {\r\n    return {\r\n      records:[],\r\n      record:{},\r\n      note: \"\",\r\n      files: []\r\n    }\r\n  },\r\n  created(){\r\n    console.log('URL', this.url)\r\n    //  this.$store.dispatch('table/getRecords', this.url)\r\n    this.getRecords()\r\n  },\r\n\r\n  methods: {\r\n    async getRecords(){\r\n      this.records = []\r\n      for await (const record of ldflex[this.url]['https://www.dublincore.org/specifications/dublin-core/dcmi-terms/hasPart']) {\r\n        let label = await ldflex[record].label\r\n        this.records.push({label: label, url: `${record}`})\r\n        // for await (const property of record.properties){\r\n        //   console.log(`${property}`);\r\n        // }\r\n      }\r\n    },\r\n    onRecordSelected(r){\r\n      console.log(r)\r\n      if (r.length > 0){\r\n        this.record = r[0]\r\n        this.$bvModal.show('modal-record-')\r\n      }\r\n      //  this.$router.push('Row')\r\n    },\r\n    async onInput(files){\r\n      console.log(files)\r\n      let preview = this.$refs.preview\r\n      // let storage = await ldflex.data.user.storage\r\n      // let path = `${storage}`+'public/portfolio/'\r\n      let path = this.storage+this.privacy+'/table/files/'\r\n      await files.forEach(async function(f)  {\r\n        console.log(f)\r\n        watermark([f])\r\n        .image(watermark.text.center(path, '30px Josefin Slab', '#fff', 0.8))\r\n        .then(img => {\r\n          img.name = f.name\r\n          img.type = f.type\r\n          img.width = \"100\"\r\n          preview.appendChild(img)});\r\n        })\r\n      },\r\n      async addFiles(){\r\n        let record_url = this.record.url\r\n        let preview = this.$refs.preview\r\n        let dataURLtoFile = this.dataURLtoFile\r\n        var images = [].slice.call(preview.children);\r\n        console.log(images)\r\n        // let storage = await ldflex.data.user.storage\r\n        // let path = `${storage}`+'public/portfolio/'\r\n        let path = this.storage+this.privacy+'/table/files/'\r\n\r\n        console.log(path)\r\n        try{\r\n          await images.forEach(async function(i)  {\r\n            let uri = path+i.name\r\n            console.log(encodeURI(uri))\r\n            var file = dataURLtoFile(i.src,i.name);\r\n            await fc.createFile(encodeURI(uri), file, i.type)\r\n            await ldflex[record_url]['https://www.dublincore.org/specifications/dublin-core/dcmi-terms/hasPart'].add(namedNode(encodeURI(uri)))\r\n\r\n          })\r\n          alert(images.length+\" fichiers sauvegardés\")\r\n        }catch(e){\r\n          alert(e)\r\n        }\r\n      },\r\n      dataURLtoFile(dataurl, filename) {\r\n        var arr = dataurl.split(','),\r\n        mime = arr[0].match(/:(.*?);/)[1],\r\n        bstr = atob(arr[1]),\r\n        n = bstr.length,\r\n        u8arr = new Uint8Array(n);\r\n        while(n--){\r\n          u8arr[n] = bstr.charCodeAt(n);\r\n        }\r\n        return new File([u8arr], filename, {type:mime});\r\n      },\r\n      async addNote(){\r\n        let note = this.note\r\n        console.log(this.record, note)\r\n        await ldflex[this.record.url]['http://www.w3.org/2004/02/skos/core#note'].add(note)\r\n        this.note = \"\"\r\n      },\r\n      async add(){\r\n        //  this.items.unshift({name: 'new record', fields: \"?\", url: \"\" })\r\n        let file = this.path+uuidv4()+'.ttl'\r\n        var dateObj = new Date();\r\n        var date = dateObj.toISOString()\r\n        let content = `@prefix : <#>.\r\n        @prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#>.\r\n        @prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>.\r\n        @prefix dct: <http://purl.org/dc/terms/>.\r\n        @prefix dbo: <http://dbpedia.org/ontology/>.\r\n\r\n        <> rdfs:label \"New Record\".\r\n        <> rdf:type dbo:Record.\r\n        <> dct:created \"${date}\".`\r\n        await fc.postFile( file, content, 'text/turtle' )\r\n        console.log(file)\r\n        await ldflex[this.table.url]['https://www.dublincore.org/specifications/dublin-core/dcmi-terms/hasPart'].add(namedNode(file))\r\n        await ldflex[file]['https://www.dublincore.org/specifications/dublin-core/dcmi-terms/partOf'].add(namedNode(this.table.url))\r\n        this.update()\r\n      },\r\n      async update(){\r\n        this.folder = await fc.readFolder(this.path)\r\n        console.log(this.folder.files)\r\n        this.records = []\r\n        this.folder.files.forEach(async(f) => {\r\n          let name =  await ldflex[f.url].label\r\n          let notes = []\r\n          let attachments = []\r\n          for await (const note of ldflex[f.url]['https://www.dublincore.org/specifications/dublin-core/dcmi-terms/hasNote']) {\r\n            notes.push(`${note}`)\r\n          }\r\n          for await (const attachment of ldflex[f.url]['https://www.dublincore.org/specifications/dublin-core/dcmi-terms/hasAttachment']) {\r\n            attachments.push(`${attachment}`)\r\n          }\r\n          console.log(\"n\",notes)\r\n          let record =   {name: `${name}`, notes: notes, attachments: attachments, url:f.url}\r\n          this.records.push(record)\r\n          //  this.workspaces.push(base)\r\n        });\r\n        //console.log(this.workspaces)\r\n\r\n      },\r\n      onValidModal(){\r\n        console.log(this.record)\r\n      },\r\n    },\r\n    watch:{\r\n      url(){\r\n        console.log(\"tables URL\",this.url)\r\n      }\r\n    }\r\n\r\n  }\r\n  </script>\r\n\r\n  <style>\r\n\r\n  </style>\r\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./TableView.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./TableView.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./TableView.vue?vue&type=template&id=7ea4e553&\"\nimport script from \"./TableView.vue?vue&type=script&lang=js&\"\nexport * from \"./TableView.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports"],"sourceRoot":""}